@page "/account/landing-page-designer"
@model Agora.Web.Pages.Account.LandingPageDesignerModel
@{
  var existingBackgroundPreviewUrl = string.IsNullOrWhiteSpace(Model.Template.BackgroundImageUrl)
    ? string.Empty
    : Model.Template.BackgroundImageUrl.StartsWith("internal:", StringComparison.OrdinalIgnoreCase)
      ? "/account/template/background"
      : Model.Template.BackgroundImageUrl;
  var previewModel = new Agora.Web.Pages.Shared.ShareLandingCardViewModel(
    Title: string.IsNullOrWhiteSpace(Model.Template.H1) ? "A file was shared with you" : Model.Template.H1,
    Subtitle: string.IsNullOrWhiteSpace(Model.Template.Title) ? null : Model.Template.Title,
    Description: string.IsNullOrWhiteSpace(Model.Template.Description) ? "Use the button below to download your file." : Model.Template.Description,
    ZipDisplayName: "example-share.zip",
    FileCount: 3,
    SizeDisplay: "2.4 MB",
    IsExpired: false,
    DownloadUrl: "#");
  var previewAlignmentClasses = Model.Template.ContainerPosition switch
  {
    "top_left" => "items-start justify-start",
    "top_right" => "items-start justify-end",
    "bottom_left" => "items-end justify-start",
    "bottom_right" => "items-end justify-end",
    "center_right" => "items-center justify-end",
    "center_left" => "items-center justify-start",
    "center_top" => "items-start justify-center",
    "center_bottom" => "items-end justify-center",
    _ => "items-center justify-center"
  };
}

<section class="mb-8">
  <h2 class="font-display text-3xl tracking-tight">Download page settings</h2>
  <p class="text-ink-muted text-sm mt-1">Set your account-wide default download page template.</p>
</section>
<section class="space-y-6">
  <div class="bg-white rounded-2xl border border-border p-6">
    <form method="post" action="/api/account/template" enctype="multipart/form-data" class="space-y-4" id="account-template-form">
      <div>
        <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Title</label>
        <input name="h1" value="@Model.Template.H1" class="w-full px-3 py-2 text-sm border border-border rounded-lg bg-cream focus:outline-none focus:border-terra" data-preview-h1 />
      </div>
      <div>
        <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Subtitle</label>
        <input name="title" value="@Model.Template.Title" class="w-full px-3 py-2 text-sm border border-border rounded-lg bg-cream focus:outline-none focus:border-terra" data-preview-title />
      </div>
      <div>
        <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Description</label>
        <textarea name="description" rows="3" class="w-full px-3 py-2 text-sm border border-border rounded-lg bg-cream focus:outline-none focus:border-terra" data-preview-description>@Model.Template.Description</textarea>
      </div>
      <div>
        <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Background image</label>
        <input type="file" name="backgroundImageFile" accept=".jpg,.jpeg,.png,.svg,.webp" class="sr-only" data-preview-background-file />
        <div class="rounded-lg border border-dashed border-border bg-cream p-4" data-preview-upload-dropzone>
          <div class="flex items-center justify-between gap-3">
            <p class="text-xs text-ink-muted">.jpg, .jpeg, .png, .svg, .webp</p>
            <button type="button" class="px-3 py-1.5 bg-ink text-white text-xs font-medium rounded-md hover:bg-ink/90 transition-colors" data-preview-upload-pick>Select image</button>
          </div>
          <div class="mt-2 text-xs text-ink-muted" data-preview-upload-status>No file selected.</div>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <div>
          <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Background color</label>
          <select name="backgroundColorMode" class="w-full px-3 py-2 text-sm border border-border rounded-lg bg-cream focus:outline-none focus:border-terra" data-preview-background-color-mode>
            <option value="default" selected="@(string.IsNullOrWhiteSpace(Model.Template.BackgroundColorHex))">Default</option>
            <option value="custom" selected="@(!string.IsNullOrWhiteSpace(Model.Template.BackgroundColorHex))">Custom</option>
          </select>
        </div>
        <div data-preview-background-color-picker-wrap>
          <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Pick color</label>
          <input type="color" name="backgroundColorHex" value="@(string.IsNullOrWhiteSpace(Model.Template.BackgroundColorHex) ? "#faf7f2" : Model.Template.BackgroundColorHex)" class="h-10 w-10 p-0 border border-border rounded-md bg-cream" data-preview-background-color />
        </div>
      </div>
      <div>
        <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Container position</label>
        <select name="containerPosition" class="w-full px-3 py-2 text-sm border border-border rounded-lg bg-cream focus:outline-none focus:border-terra" data-preview-container-position>
          <option value="center" selected="@(Model.Template.ContainerPosition == "center")">Centered</option>
          <option value="top_left" selected="@(Model.Template.ContainerPosition == "top_left")">Top left</option>
          <option value="top_right" selected="@(Model.Template.ContainerPosition == "top_right")">Top right</option>
          <option value="bottom_left" selected="@(Model.Template.ContainerPosition == "bottom_left")">Bottom left</option>
          <option value="bottom_right" selected="@(Model.Template.ContainerPosition == "bottom_right")">Bottom right</option>
          <option value="center_right" selected="@(Model.Template.ContainerPosition == "center_right")">Centered right</option>
          <option value="center_left" selected="@(Model.Template.ContainerPosition == "center_left")">Centered left</option>
          <option value="center_top" selected="@(Model.Template.ContainerPosition == "center_top")">Centered top</option>
          <option value="center_bottom" selected="@(Model.Template.ContainerPosition == "center_bottom")">Centered bottom</option>
        </select>
      </div>
      <div class="flex items-center justify-end">
        <button type="submit" class="px-6 py-2.5 bg-ink text-white text-sm font-medium rounded-lg hover:bg-ink/90">Save template</button>
      </div>
    </form>
  </div>
  <div class="bg-white rounded-2xl border border-border p-6">
    <p class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-2">Preview</p>
    <div class="rounded-2xl border border-border p-4 bg-cover bg-center aspect-[4/3]" data-preview-surface style="background-color:#faf7f2;">
      <div class="h-full w-full flex @previewAlignmentClasses" data-preview-wrapper>
        @await Html.PartialAsync("/Pages/Shared/_ShareLandingCard.cshtml", previewModel)
      </div>
    </div>
  </div>
</section>

<script src="/js/account-landing-designer.js" data-initial-background-url="@existingBackgroundPreviewUrl"></script>
