@page "/"
@model Agora.Web.Pages.IndexModel
@using System.Text.Json
@{
  var nowUtc = DateTime.UtcNow;
  string FormatFileSize(long bytes)
  {
    if (bytes >= 1024L * 1024L * 1024L) return $"{bytes / (1024.0 * 1024.0 * 1024.0):F2} GB";
    if (bytes >= 1024L * 1024L) return $"{bytes / (1024.0 * 1024.0):F2} MB";
    if (bytes >= 1024L) return $"{bytes / 1024.0:F2} KB";
    return $"{bytes} B";
  }
}
<section class="mb-10 rounded-2xl border border-border bg-white p-8">
  <h1 class="font-display text-5xl tracking-tight leading-tight">Fast, branded file sharing for your team.</h1>
  <p class="text-ink-muted text-sm mt-4 max-w-xl">Create expiring share links with customizable download pages, download notifications, and background processing built in.</p>

  <input type="hidden" value="@Model.QuickDraftShareId" data-quick-share-draft-id />
  <input type="file" multiple accept="*/*" class="sr-only" data-quick-share-input />
  <div class="mt-6 rounded-lg border border-dashed border-border bg-cream p-4 cursor-pointer" data-quick-share-dropzone data-max-files-per-share="@Model.MaxFilesPerShare" data-max-file-size-bytes="@Model.MaxFileSizeBytes" data-max-total-upload-bytes="@Model.MaxTotalUploadBytes" tabindex="0" role="button">
    <div class="flex items-center justify-between gap-3">
      <p class="text-sm text-ink-light">Drop files here or click to select â€” max @Model.MaxFilesPerShare files, @FormatFileSize(Model.MaxFileSizeBytes) per file, @FormatFileSize(Model.MaxTotalUploadBytes) total</p>
      <div class="flex items-center gap-2">
        <button type="button" class="hidden px-3 py-1.5 border border-border bg-cream-dark/70 text-ink text-xs font-medium rounded-md hover:bg-cream-dark transition-colors disabled:opacity-60 disabled:cursor-not-allowed" data-quick-share-cancel disabled title="No upload is currently running.">Cancel upload</button>
        <button type="button" class="px-3 py-1.5 bg-terra text-white text-xs font-medium rounded-md hover:bg-terra/90 transition-colors" data-quick-share-pick>Choose files</button>
      </div>
    </div>
    <p class="text-xs text-ink-muted mt-2" data-quick-share-status>We'll take you to the next step as soon as your files are ready.</p>
    <ul class="mt-3 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2" data-quick-share-upload-list></ul>
  </div>
</section>

@if (Model.OwnShares.Count > 0 || Model.ReceivedShares.Count > 0)
{
@if (Model.OwnShares.Count > 0)
{
<section class="mb-8">
  <div class="bg-white rounded-2xl border border-border overflow-hidden">
    <div class="px-5 py-3 border-b border-border bg-cream-dark/50 flex items-center justify-between">
      <h2 class="font-display text-xl">Previous shares</h2>
      <span class="text-xs text-ink-muted">@Model.OwnShares.Count shown</span>
    </div>
    <table class="w-full">
      <thead>
        <tr class="text-xs font-medium text-ink-muted uppercase tracking-wider border-b border-border">
          <th class="text-left px-4 py-2">Archive</th>
          <th class="text-left px-4 py-2">Details</th>
          <th class="text-left px-4 py-2">State</th>
          <th class="text-left px-4 py-2">Created</th>
          <th class="text-left px-4 py-2">Expires</th>
          <th class="text-left px-4 py-2" title="Number of times downloaded by others">DLs</th>
          <th class="text-right px-4 py-2">Actions</th>
        </tr>
      </thead>
      <tbody>
        @foreach (var share in Model.OwnShares)
        {
          var isExpired = share.ExpiresAtUtc is not null && share.ExpiresAtUtc <= nowUtc;
          var state = share.DeletedAtUtc is not null ? "Deleted" : isExpired ? "Expired" : "Active";
          var stateClass = state == "Active" ? "bg-sage-wash text-sage" : state == "Expired" ? "bg-cream-dark text-ink-muted" : "bg-danger-wash text-danger";
          var size = share.ZipSizeBytes >= 1024 * 1024 ? $"{share.ZipSizeBytes / (1024.0 * 1024.0):F1} MB" : $"{share.ZipSizeBytes / 1024.0:F0} KB";
          var filesJson = JsonSerializer.Serialize(share.Files);
          <tr class="border-b border-border/60 hover:bg-cream-dark/40 transition-colors">
            <td class="px-4 py-3 text-sm">@share.ZipDisplayName</td>
            <td class="px-4 py-3 text-xs text-ink-muted">
              <button type="button" class="text-xs text-terra hover:underline" data-share-details-trigger data-share-name="@share.ZipDisplayName" data-share-files='@filesJson'>@share.FileCount file(s) - @size</button>
            </td>
            <td class="px-4 py-3"><span class="text-xs px-2 py-0.5 rounded-md @stateClass">@state</span></td>
            <td class="px-4 py-3"><span class="text-xs text-ink-muted" data-local-datetime="@share.CreatedAtUtc.ToString("O")"></span></td>
            <td class="px-4 py-3">
              @if (share.ExpiresAtUtc is null)
              {
                <span class="text-xs text-ink-muted">Never</span>
              }
              else
              {
                <span class="text-xs text-ink-muted" data-local-datetime="@share.ExpiresAtUtc.Value.ToString("O")"></span>
              }
            </td>
            <td class="px-4 py-3 text-xs text-ink-muted">@share.DownloadCount</td>
            <td class="px-4 py-3 text-right space-x-2">
              <form method="post" action="/shares/@share.ShareId/show-link" class="inline">
                <button type="submit" class="text-xs text-terra hover:underline">Show link</button>
              </form>
              @if (isExpired)
              {
                <form method="post" action="/shares/@share.ShareId/reenable" class="inline">
                  <button type="submit" class="text-xs text-sage hover:underline">Re-enable 24h</button>
                </form>
              }
              <form method="post" action="/shares/@share.ShareId/delete" class="inline" data-share-delete-form data-share-name="@share.ZipDisplayName">
                <button type="button" class="text-xs text-danger hover:underline" data-share-delete-trigger>Delete</button>
              </form>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</section>
}

@if (Model.ReceivedShares.Count > 0)
{
<section>
  <div class="bg-white rounded-2xl border border-border overflow-hidden">
    <form method="post" action="/shares/delete-batch">
      <div class="px-5 py-3 border-b border-border bg-cream-dark/50 flex items-center justify-between gap-4">
        <div>
          <h2 class="font-display text-xl">Files sent to me</h2>
          <p class="text-xs text-ink-muted mt-1">These uploads do not expire automatically. Delete when you no longer need them.</p>
        </div>
        <button type="submit" class="px-3 py-1.5 text-xs font-medium rounded-md border border-danger/50 text-danger hover:bg-danger-wash" title="Select at least one row to delete.">Delete selected</button>
      </div>
      <table class="w-full">
        <thead>
          <tr class="text-xs font-medium text-ink-muted uppercase tracking-wider border-b border-border">
            <th class="text-left px-4 py-2 w-10">
              <input type="checkbox" data-received-select-all aria-label="Select all received files" />
            </th>
            <th class="text-left px-4 py-2">Archive</th>
            <th class="text-left px-4 py-2">Sender</th>
            <th class="text-left px-4 py-2">Email</th>
            <th class="text-left px-4 py-2">Details</th>
            <th class="text-left px-4 py-2">Created</th>
            <th class="text-right px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody>
          @foreach (var share in Model.ReceivedShares)
          {
            var size = share.ZipSizeBytes >= 1024 * 1024 ? $"{share.ZipSizeBytes / (1024.0 * 1024.0):F1} MB" : $"{share.ZipSizeBytes / 1024.0:F0} KB";
            var filesJson = JsonSerializer.Serialize(share.Files);
            <tr class="border-b border-border/60 hover:bg-cream-dark/40 transition-colors">
              <td class="px-4 py-3">
                <input type="checkbox" name="shareIds" value="@share.ShareId" data-received-select />
              </td>
              <td class="px-4 py-3 text-sm">@share.ZipDisplayName</td>
              <td class="px-4 py-3 text-xs text-ink-muted">@(string.IsNullOrWhiteSpace(share.SenderName) ? "-" : share.SenderName)</td>
              <td class="px-4 py-3 text-xs text-ink-muted">@(string.IsNullOrWhiteSpace(share.SenderEmail) ? "-" : share.SenderEmail)</td>
              <td class="px-4 py-3 text-xs text-ink-muted">
                <button type="button"
                        class="text-xs text-terra hover:underline"
                        data-share-details-trigger
                        data-share-name="@share.ZipDisplayName"
                        data-share-files='@filesJson'
                        data-share-sender-name="@share.SenderName"
                        data-share-sender-email="@share.SenderEmail"
                        data-share-sender-message="@share.SenderMessage">@share.FileCount file(s) - @size</button>
              </td>
              <td class="px-4 py-3"><span class="text-xs text-ink-muted" data-local-datetime="@share.CreatedAtUtc.ToString("O")"></span></td>
              <td class="px-4 py-3 text-right space-x-2">
                <form method="post" action="/shares/@share.ShareId/show-link" class="inline">
                  <button type="submit" class="text-xs text-terra hover:underline">Show link</button>
                </form>
                <form method="post" action="/shares/@share.ShareId/delete" class="inline" data-share-delete-form data-share-name="@share.ZipDisplayName">
                  <button type="button" class="text-xs text-danger hover:underline" data-share-delete-trigger>Delete</button>
                </form>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </form>
  </div>
</section>
}
}
else
{
<section class="grid grid-cols-1 md:grid-cols-3 gap-4">
  <article class="md:col-span-2 bg-white rounded-2xl border border-border p-6">
    <p class="text-xs uppercase tracking-wider text-ink-muted">Get it done</p>
    <h3 class="font-display text-3xl tracking-tight mt-2">Send large files without the back-and-forth</h3>
    <p class="text-sm text-ink-muted mt-3">When you need to deliver files quickly, Agora gives you one simple flow: drop files, tune expiry, share the link.</p>
  </article>
  <article class="bg-white rounded-2xl border border-border p-6">
    <p class="text-xs uppercase tracking-wider text-ink-muted">Full control</p>
    <h3 class="font-display text-2xl mt-2">Host it where your data lives</h3>
    <p class="text-sm text-ink-muted mt-2">Keep files, logs, and policies on your own infrastructure so governance and retention stay in your hands.</p>
  </article>
  <article class="bg-white rounded-2xl border border-border p-6">
    <p class="text-xs uppercase tracking-wider text-ink-muted">Ease of use</p>
    <h3 class="font-display text-2xl mt-2">Simple for senders and recipients</h3>
    <p class="text-sm text-ink-muted mt-2">Your team gets a clean sharing workflow, while recipients get a clear branded page and one-click download.</p>
  </article>
  <article class="md:col-span-2 bg-white rounded-2xl border border-border p-6">
    <p class="text-xs uppercase tracking-wider text-ink-muted">Operate with confidence</p>
    <h3 class="font-display text-2xl mt-2">Automate lifecycle, keep visibility</h3>
    <p class="text-sm text-ink-muted mt-2">Expiration, cleanup, and notifications run in the background so sharing stays reliable without manual follow-up.</p>
  </article>
</section>
}

<dialog class="rounded-xl border border-border bg-white p-0 w-full max-w-sm backdrop:bg-black/30 m-auto" style="margin: auto;" data-share-delete-dialog>
  <form method="dialog" class="p-5">
    <h3 class="font-display text-2xl tracking-tight">Delete share?</h3>
    <p class="text-sm text-ink-muted mt-2">This removes the share immediately. File cleanup runs in the background.</p>
    <p class="text-sm text-ink-light mt-2" data-share-delete-name></p>
    <div class="mt-5 flex justify-end gap-2">
      <button type="button" class="px-4 py-2 text-sm border border-border rounded-lg bg-cream hover:bg-cream-dark/70" data-share-delete-cancel>Cancel</button>
      <button type="button" class="px-4 py-2 text-sm bg-danger text-white rounded-lg hover:bg-danger/90" data-share-delete-confirm>Delete</button>
    </div>
  </form>
</dialog>

<dialog class="rounded-xl border border-border bg-white p-0 w-full max-w-xl backdrop:bg-black/30 m-auto" style="margin: auto;" data-share-details-dialog>
  <form method="dialog" class="p-5">
    <h3 class="font-display text-2xl tracking-tight">Share details</h3>
    <p class="text-sm text-ink-light mt-2" data-share-details-name></p>
    <div class="mt-2 space-y-1 text-xs text-ink-muted">
      <p data-share-details-sender-name></p>
      <p data-share-details-sender-email></p>
      <p class="whitespace-pre-wrap" data-share-details-sender-message></p>
    </div>
    <div class="mt-4 rounded-lg border border-border overflow-hidden">
      <table class="w-full">
        <thead>
          <tr class="text-xs font-medium text-ink-muted uppercase tracking-wider border-b border-border bg-cream-dark/40">
            <th class="text-left px-3 py-2">File</th>
            <th class="text-right px-3 py-2">Size</th>
          </tr>
        </thead>
        <tbody data-share-details-list></tbody>
      </table>
    </div>
    <div class="mt-5 flex justify-end">
      <button type="button" class="px-4 py-2 text-sm border border-border rounded-lg bg-cream hover:bg-cream-dark/70" data-share-details-close>Close</button>
    </div>
  </form>
</dialog>

<script src="/js/index.js"></script>
