@page "/share/landing-page-designer"
@model Agora.Web.Pages.Share.LandingPageDesignerModel
@{
  var existingBackgroundPreviewUrl = string.IsNullOrWhiteSpace(Model.DraftTemplate.BackgroundUploadId)
    ? string.Empty
    : $"/api/share-drafts/{Model.DraftShareId}/background-preview?uploadId={Uri.EscapeDataString(Model.DraftTemplate.BackgroundUploadId)}";
  var previewModel = new Agora.Web.Pages.Shared.ShareLandingCardViewModel(
    Title: string.IsNullOrWhiteSpace(Model.DraftTemplate.H1) ? "A file was shared with you" : Model.DraftTemplate.H1,
    Subtitle: string.IsNullOrWhiteSpace(Model.DraftTemplate.Title) ? null : Model.DraftTemplate.Title,
    Description: string.IsNullOrWhiteSpace(Model.DraftTemplate.Description) ? "Use the button below to download your file." : Model.DraftTemplate.Description,
    ZipDisplayName: "example-share.zip",
    FileCount: 3,
    SizeDisplay: "2.4 MB",
    IsExpired: false,
    DownloadUrl: "#");
  var previewAlignmentClasses = Model.DraftTemplate.ContainerPosition switch
  {
    "top_left" => "items-start justify-start",
    "top_right" => "items-start justify-end",
    "bottom_left" => "items-end justify-start",
    "bottom_right" => "items-end justify-end",
    "center_right" => "items-center justify-end",
    "center_left" => "items-center justify-start",
    "center_top" => "items-start justify-center",
    "center_bottom" => "items-end justify-center",
    _ => "items-center justify-center"
  };
}

<section class="mb-8">
  <h2 class="font-display text-3xl tracking-tight">Share download page designer</h2>
  <p class="text-ink-muted text-sm mt-1">Configure this share's download page. Save and return to the upload form.</p>
</section>
<section class="space-y-6">
  <div class="bg-white rounded-2xl border border-border p-6">
    <form id="share-template-form" class="space-y-4" method="post" action="/api/share-drafts/@Model.DraftShareId/template">
      <div>
        <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Title</label>
        <input name="h1" data-template-h1 value="@Model.DraftTemplate.H1" class="w-full px-3 py-2 text-sm border border-border rounded-lg bg-cream focus:outline-none focus:border-terra" />
      </div>
      <div>
        <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Subtitle</label>
        <input name="title" data-template-title value="@Model.DraftTemplate.Title" class="w-full px-3 py-2 text-sm border border-border rounded-lg bg-cream focus:outline-none focus:border-terra" />
      </div>
      <div>
        <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Description</label>
        <textarea rows="3" name="description" data-template-description class="w-full px-3 py-2 text-sm border border-border rounded-lg bg-cream focus:outline-none focus:border-terra">@Model.DraftTemplate.Description</textarea>
      </div>
      <div>
        <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Background image</label>
        <input type="hidden" name="backgroundUploadId" value="@Model.DraftTemplate.BackgroundUploadId" data-template-background-upload-id />
        <input type="hidden" name="backgroundColorHex" value="@Model.DraftTemplate.BackgroundColorHex" data-template-background-color-hex />
        <input type="hidden" name="containerPosition" value="@Model.DraftTemplate.ContainerPosition" data-template-container-position />
        <input type="hidden" value="@Model.DraftShareId" data-draft-share-id />
        <input type="file" accept=".jpg,.jpeg,.png,.svg,.webp" data-template-background-file class="sr-only" />
        <div class="rounded-lg border border-dashed border-border bg-cream p-4" data-template-upload-dropzone>
          <div class="flex items-center justify-between gap-3">
            <p class="text-xs text-ink-muted">.jpg, .jpeg, .png, .svg, .webp</p>
            <button type="button" class="px-3 py-1.5 bg-ink text-white text-xs font-medium rounded-md hover:bg-ink/90 transition-colors" data-template-upload-pick>Select image</button>
          </div>
          <div class="mt-2 text-xs text-ink-muted" data-template-upload-status>No uploaded background image.</div>
        </div>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
        <div>
          <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Background color</label>
          <select class="w-full px-3 py-2 text-sm border border-border rounded-lg bg-cream focus:outline-none focus:border-terra" data-template-background-color-mode>
            <option value="default" selected="@(string.IsNullOrWhiteSpace(Model.DraftTemplate.BackgroundColorHex))">Default</option>
            <option value="custom" selected="@(!string.IsNullOrWhiteSpace(Model.DraftTemplate.BackgroundColorHex))">Custom</option>
          </select>
        </div>
        <div data-template-background-color-picker-wrap>
          <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Pick color</label>
          <input type="color" value="@(string.IsNullOrWhiteSpace(Model.DraftTemplate.BackgroundColorHex) ? "#faf7f2" : Model.DraftTemplate.BackgroundColorHex)" class="h-10 w-full px-1 py-1 border border-border rounded-lg bg-cream" data-template-background-color />
        </div>
        <div>
          <label class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-1.5 block">Container position</label>
          <select class="w-full px-3 py-2 text-sm border border-border rounded-lg bg-cream focus:outline-none focus:border-terra" data-template-container-position-select>
            <option value="center" selected="@(Model.DraftTemplate.ContainerPosition == "center")">Centered</option>
            <option value="top_left" selected="@(Model.DraftTemplate.ContainerPosition == "top_left")">Top left</option>
            <option value="top_right" selected="@(Model.DraftTemplate.ContainerPosition == "top_right")">Top right</option>
            <option value="bottom_left" selected="@(Model.DraftTemplate.ContainerPosition == "bottom_left")">Bottom left</option>
            <option value="bottom_right" selected="@(Model.DraftTemplate.ContainerPosition == "bottom_right")">Bottom right</option>
            <option value="center_right" selected="@(Model.DraftTemplate.ContainerPosition == "center_right")">Centered right</option>
            <option value="center_left" selected="@(Model.DraftTemplate.ContainerPosition == "center_left")">Centered left</option>
            <option value="center_top" selected="@(Model.DraftTemplate.ContainerPosition == "center_top")">Centered top</option>
            <option value="center_bottom" selected="@(Model.DraftTemplate.ContainerPosition == "center_bottom")">Centered bottom</option>
          </select>
        </div>
      </div>
      <div class="flex items-center justify-between">
        <a href="/shares/new?draftShareId=@Model.DraftShareId" class="text-sm text-ink-muted hover:text-ink">Cancel</a>
        <button type="submit" class="px-6 py-2.5 bg-ink text-white text-sm font-medium rounded-lg hover:bg-ink/90">Save and return</button>
      </div>
    </form>
  </div>
  <div class="bg-white rounded-2xl border border-border p-6">
    <p class="text-xs font-medium text-ink-muted uppercase tracking-wider mb-2">Preview</p>
    <div class="rounded-2xl border border-border p-4 bg-cover bg-center aspect-[4/3]" data-preview-surface style="background-color:#faf7f2;">
      <div class="h-full w-full flex @previewAlignmentClasses" data-preview-wrapper>
        @await Html.PartialAsync("/Pages/Shared/_ShareLandingCard.cshtml", previewModel)
      </div>
    </div>
  </div>
</section>

<script src="/js/share-landing-designer.js" data-initial-background-url="@existingBackgroundPreviewUrl"></script>
