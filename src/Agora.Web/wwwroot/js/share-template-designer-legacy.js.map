{
  "version": 3,
  "sources": ["../../Scripts/share-template-designer-legacy.ts"],
  "sourcesContent": ["(() => {\n  const form = document.getElementById('share-template-form') as HTMLFormElement | null;\n  if (!form) return;\n\n  const titleInput = form.querySelector<HTMLInputElement>('[data-template-title]');\n  const h1Input = form.querySelector<HTMLInputElement>('[data-template-h1]');\n  const descriptionInput = form.querySelector<HTMLTextAreaElement>('[data-template-description]');\n  const backgroundFileInput = form.querySelector<HTMLInputElement>('[data-template-background-file]');\n  const backgroundUploadIdInput = form.querySelector<HTMLInputElement>('[data-template-background-upload-id]');\n  const backgroundColorHexInput = form.querySelector<HTMLInputElement>('[data-template-background-color-hex]');\n  const backgroundColorModeInput = form.querySelector<HTMLSelectElement>('[data-template-background-color-mode]');\n  const backgroundColorInput = form.querySelector<HTMLInputElement>('[data-template-background-color]');\n  const backgroundColorWrap = form.querySelector<HTMLElement>('[data-template-background-color-picker-wrap]');\n  const draftShareIdInput = form.querySelector<HTMLInputElement>('[data-draft-share-id]');\n  const uploadDropzone = form.querySelector<HTMLElement>('[data-template-upload-dropzone]');\n  const uploadPick = form.querySelector<HTMLButtonElement>('[data-template-upload-pick]');\n  const uploadStatus = form.querySelector<HTMLElement>('[data-template-upload-status]');\n  const previewTitle = document.querySelector<HTMLElement>('[data-preview-title]');\n  const previewH1 = document.querySelector<HTMLElement>('[data-preview-h1]');\n  const previewDescription = document.querySelector<HTMLElement>('[data-preview-description]');\n  const previewCard = document.querySelector<HTMLElement>('[data-preview-card]');\n\n  if (\n    !titleInput ||\n    !h1Input ||\n    !descriptionInput ||\n    !backgroundFileInput ||\n    !backgroundUploadIdInput ||\n    !uploadDropzone ||\n    !uploadPick ||\n    !uploadStatus ||\n    !previewTitle ||\n    !previewH1 ||\n    !previewDescription ||\n    !previewCard\n  ) {\n    return;\n  }\n\n  const allowedExtensions = new Set(['.jpg', '.jpeg', '.png', '.svg', '.webp']);\n  let uploadedPreviewUrl = '';\n\n  const updatePreview = (): void => {\n    previewTitle.textContent = titleInput.value || 'Shared file';\n    previewH1.textContent = h1Input.value || 'A file was shared with you';\n    previewDescription.textContent = descriptionInput.value || '';\n\n    const customBackgroundColor =\n      backgroundColorModeInput && backgroundColorInput && backgroundColorModeInput.value === 'custom'\n        ? backgroundColorInput.value\n        : '';\n\n    previewCard.style.backgroundColor = customBackgroundColor || '';\n    previewCard.style.backgroundImage = uploadedPreviewUrl ? `url(${uploadedPreviewUrl})` : '';\n  };\n\n  const setStatus = (text: string, isError: boolean): void => {\n    uploadStatus.textContent = text;\n    uploadStatus.classList.remove('text-ink-muted', 'text-danger');\n    uploadStatus.classList.add(isError ? 'text-danger' : 'text-ink-muted');\n  };\n\n  const stageBackground = (file: File): void => {\n    setStatus('Uploading background image...', false);\n\n    const formData = new FormData();\n    formData.append('file', file, file.name);\n    if (draftShareIdInput?.value) {\n      formData.append('draftShareId', draftShareIdInput.value);\n    }\n\n    fetch('/api/uploads/stage-template-background', { method: 'POST', body: formData })\n      .then((response) => (response.ok ? response.json() : Promise.reject(new Error('Upload failed'))))\n      .then((json: { uploadId?: string; fileName?: string }) => {\n        const backgroundUploadId = json.uploadId || '';\n        backgroundUploadIdInput.value = backgroundUploadId;\n\n        if (uploadedPreviewUrl) URL.revokeObjectURL(uploadedPreviewUrl);\n        uploadedPreviewUrl = URL.createObjectURL(file);\n\n        setStatus(backgroundUploadId ? `Uploaded: ${json.fileName || file.name}` : 'Upload failed.', !backgroundUploadId);\n        updatePreview();\n      })\n      .catch(() => {\n        setStatus('Upload failed.', true);\n      });\n  };\n\n  const handleSelectedFiles = (files: FileList | File[]): void => {\n    const list = Array.from(files || []);\n    if (!list.length) return;\n    if (list.length > 1) {\n      setStatus('Only one image can be selected.', true);\n      return;\n    }\n\n    const file = list[0];\n    const ext = file.name.includes('.') ? file.name.toLowerCase().slice(file.name.lastIndexOf('.')) : '';\n    if (!allowedExtensions.has(ext)) {\n      setStatus('Only JPG, PNG, SVG, or WEBP files are allowed.', true);\n      return;\n    }\n\n    stageBackground(file);\n  };\n\n  [titleInput, h1Input, descriptionInput].forEach((el) => el.addEventListener('input', updatePreview));\n\n  if (backgroundColorModeInput && backgroundColorInput && backgroundColorHexInput) {\n    const refreshColorMode = (): void => {\n      const isCustom = backgroundColorModeInput.value === 'custom';\n      backgroundColorWrap?.classList.toggle('hidden', !isCustom);\n      backgroundColorHexInput.value = isCustom ? backgroundColorInput.value : '';\n      updatePreview();\n    };\n\n    backgroundColorModeInput.addEventListener('change', refreshColorMode);\n    backgroundColorInput.addEventListener('input', refreshColorMode);\n    refreshColorMode();\n  }\n\n  uploadPick.addEventListener('click', () => backgroundFileInput.click());\n  backgroundFileInput.addEventListener('change', () => handleSelectedFiles(backgroundFileInput.files || []));\n\n  uploadDropzone.addEventListener('dragover', (event) => {\n    event.preventDefault();\n    uploadDropzone.classList.add('ring-2', 'ring-terra/40');\n  });\n  uploadDropzone.addEventListener('dragleave', () => uploadDropzone.classList.remove('ring-2', 'ring-terra/40'));\n  uploadDropzone.addEventListener('drop', (event) => {\n    event.preventDefault();\n    uploadDropzone.classList.remove('ring-2', 'ring-terra/40');\n    handleSelectedFiles(event.dataTransfer?.files || []);\n  });\n\n  if (backgroundUploadIdInput.value) {\n    setStatus('Uploaded background image selected.', false);\n  }\n\n  updatePreview();\n})();\n"],
  "mappings": "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",
  "names": []
}
